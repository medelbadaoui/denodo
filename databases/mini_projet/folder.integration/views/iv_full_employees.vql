CREATE OR REPLACE VIEW iv_full_employees FOLDER = '/integration' AS SELECT bv_data_helper.fulldate AS fulldate, bv_data_helper.month AS month, iv_full_employees_info.sal_mat_paie AS sal_mat_paie, iv_full_employees_info.sal_empli AS sal_empli, iv_full_employees_info.date_ent AS date_ent, iv_full_employees_info.date_fin AS date_fin, iv_full_employees_info.sal_motifsot AS sal_motifsot, iv_full_employees_info.sal_motif_ent AS sal_motif_ent, iv_full_employees_info.type_contrat AS type_contrat, iv_full_employees_info.sal_danc AS sal_danc, iv_full_employees_info.sal_catsoc AS sal_catsoc, iv_full_employees_info.sal_hmens AS sal_hmens, iv_full_employees_info.sal_qualif_referentiel AS sal_qualif_referentiel, iv_full_employees_info.num_rtablissement AS num_rtablissement, iv_full_employees_info.id_paye AS id_paye, iv_full_employees_info.nom_payé AS nom_payé, iv_full_employees_info.desc_motif_sort AS desc_motif_sort, iv_full_employees_info.nom_etabl AS nom_etabl, iv_full_employees_info.full_name AS full_name, iv_full_employees_info.date_nais AS date_nais, iv_full_employees_info.mail AS mail, iv_full_employees_info.nb_enf AS nb_enf, iv_full_employees_info.age AS age, (getyear(to_localdate('MM/yyyy', bv_data_helper.month))-getyear(iv_full_employees_info.date_nais)) AS age_in_period, case WHEN (iv_full_employees_info.sal_hmens >= 152) THEN 'full-time' ELSE 'part-time' END AS job_type, case WHEN ((date_ent >= to_localdate('MM/yyyy', month) AND date_ent < lastdayofmonth(to_localdate('MM/yyyy', month)))) THEN true ELSE false END AS new_member, case WHEN (date_fin < lastdayofmonth(to_localdate('MM/yyyy', month))) THEN true ELSE false END AS left_member, iv_full_employees_info.ind_sexe AS ind_sexe FROM iv_full_employees_info AS iv_full_employees_info INNER JOIN bv_data_helper AS bv_data_helper ON (iv_full_employees_info.date_ent <= lastdayofmonth(to_localdate('MM/yyyy', bv_data_helper.month)) AND iv_full_employees_info.date_fin >= firstdayofmonth(to_localdate('MM/yyyy', bv_data_helper.month))) ;

ALTER VIEW iv_full_employees
 LAYOUT (iv_full_employees_info = [110, 140, 430, 465], bv_data_helper = [870, 210, 200, 65]);

